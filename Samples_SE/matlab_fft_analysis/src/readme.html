<html>
<head>
	<title>Readme</title>
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
	<meta name="author" content="Arek Golec">
	<link rel="stylesheet" type="text/css" href="../readme_files/style.css">
</head>

<body>
<h3>DESCRIPTION:</h3>

<p>
	The MATLAB_FFT_ANALYSIS is a simple DSP design using 1024-point FFT component.
</p>

<p>
	The purpose of this design is to demonstrate the capabilities of the Active-HDL CoSimulation Interface to MATLAB&reg.
</p>

<p>
	MATLAB&reg; software can be downloaded from the MathWorks website <a href="http://www.mathworks.com">www.mathworks.com</a>.
</p>

<p>
	The design consists of an FFT design and a testbench, both described in VHDL. The testbench uses a set of foreign functions and procedures provided by the Active-HDL CoSimulation Interface to MATLAB. These functions allow to move a part of the testbench to MATLAB environment and use its analysis and visualization capabilities.
</p>

<p>
	<img src="../readme_files/matlab_cosim.png" alt="Fig. 1. Active-HDL CoSimulation Interface to MATLAB"><br>
	<i>Fig. 1. Active-HDL CoSimulation Interface to MATLAB</i>
</p>
<p>
	The VHDL part of testbench generates FFT control signals (start, reset, clk, ce, inv) and FFT input 2kHz square wave, instantiates FFT entity, and uses functions responsible for control over MATLAB workspace and data transfer between Active-HDL and MATLAB workspace.<br>
	The MATLAB part of testbench takes FFT input 2kHz square wave generated by VHDL part, multiplies each sample by window function coefficient and gives it back to VHDL part in order to drive FFT input. It also takes this input, calculates FFT using MATLAB built-in fft() function and compares calculated FFT with outputs of FFT model written in VHDL. Finally, it draws plots for data visualization. Testbench is created as Block Diagram what gives good readability.
</p>

<h3>THE TESTBENCH SCENARIO:</h3>

<ol>
	<li>Generate square wave in VHDL,</li>
	<li>Apply the window function to generated square wave in MATLAB,</li>
	<li>Drive FFT design with windowed signal in VHDL,</li>
	<li>Analyze and visualize input and output FFT data in MATLAB.</li>
</ol>

<p>
	<img src="../readme_files/matlab_testbench.png" alt="Fig. 2. The testbench scenario"><br>
	<i>Fig. 2. The testbench scenario</i>
</p>

<h3>FILES:</h3>

<ol>
	<li>Active-HDL design resources:
		<ul>
			<li>readme.html - this file</li>
			<li>compile.do - compilation macro</li>
			<li>run.do - simulation macro</li>
			<li>top_fft_tb.bde - testbench for FFT design</li>
			<li>control.asf - FFT design source file</li>
			<li>top_fft.bde - FFT design source file</li>
			<li>ram.vhd - FFT design source file</li>
			<li>cfft folder - complex FFT open core design</li>
		</ul>

		<br>
	</li>

	<li>MATLAB M-files:
		<ul>
			<li>prepare_workspace.m - MATLAB workspace initialisation</li>
			<li>display_input.m - FFT input data visualisation</li>
			<li>analyse.m - FFT data analysis</li>
			<li>display_output.m - FFT output data visualisation</li>
		</ul>

		<br>
	</li>

	<li>MATLAB data files:
		<ul>
			<li>windows1024.mat - window functions coefficients</li>
		</ul>

		<br>
	</li>
</ol>


<H3>SETUP:</H3>
<p>
	Before the very first use of the interface, type in the following command at the command prompt: "matlab /regserver". The command needs to be entered only once. (You do not need to re-enter it even after a system restart.)
</p>
<p>
	Before cosimulation, all folders containing M-Files and other files reffered in MATLAB during cosimulation, must be added to MATLAB search path. The only exception is when all necessary files are located in folder which is Active-HDL current folder (pwd) at the moment of cosimulation start (when asim command is invoked). In case of this design, this is true as long as current folder is set to default "$dsn/src".
</p>

<p>
	Also, the "$MATLAB\bin\win32" folder (where $MATLAB stands for the MATLAB installation folder) must be added to the system path.
</p>

<h3>COSIMULATION:</h3>
<p>
	The macro files attached to the design are provided for automation of the cosimulation process. Use the 'compile.do' macro to compile the necessary design files. Use the 'run.do' macro to start the cosimulation. During simulation, the 'MATLAB Command Window' opens, the Workspace window is displayed, and a set of plots visualize the analyzed data.
</p>
<p>
	The connection to MATLAB is established automatically when any of following subprograms is reached in the VHDL code:
</p>

<ul>
	<li>eval_string()</li>
	<li>put_variable()</li>
	<li>get_variable()</li>
	<li>put_item()</li>
	<li>get_item()</li>
	<li>hdl2ml()</li>
	<li>ml2hdl()</li>
</ul>

<p>
	Here, in this example, the first executed procedure call is eval_string().
</p>

<p>
	All messages reported by the MATLAB during cosimulation are displayed in the Active-HDL Console window. You may see some error messages caused by intentional mistakes introduced in the executed M-Files.
</p>
<p>
	As the cosimulation advances the MATLAB Workspace window and a plot figure displaying subsequent contents of FFT input buffer (the plot title applied shows the type of window function) can be observed.<br>
	Right before the simulation end a set of plots with analyzed data for selected window function is displayed.
</p>

<p>
	<img src="../readme_files/results.png" alt="Fig. 3. Analysis results"><br>
	<i>Fig. 3. Analysis results</i>
<p>

<p>
	The Fast Fourier Transform implementation has been downloaded from the <a href="http://www.opencores.org">www.opencores.org</a>. For copyright notices, please refer to the aforementioned website.
</p>

</body>
</html>
